version: '3'
services:
  db:
    image: 'postgres:10.3-alpine'
    volumes:
      - 'data-volume:/var/lib/postgresql/data'
  mailcatcher:
    image: schickling/mailcatcher
    ports:
      - "1025:1025"
      - "1080:1080"
  web:
    command: >
      sh -c "(bundle check || bundle install) &&
      rm -f tmp/pids/server.pid && bundle exec rails s -p 3002 -b 0.0.0.0"
    build: .
    links:
      - mailcatcher
    volumes:
      - .:/usr/src/kw-app
      - gems:/kw-app-gems
    ports:
      - "3002:3002"
    depends_on:
      - db
    tty: true
    stdin_open: true
volumes:
  data-volume:
  gems:
